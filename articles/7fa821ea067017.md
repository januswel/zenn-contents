---
title: "Zod Mini ç§»è¡Œã¯æ€–ããªã„"
emoji: "ğŸš"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["zod"]
published: true
publication_name: "beingish"
---

Zod v4 ã‹ã‚‰ Zod Mini ã¨ã„ã†è»½é‡æ¿ãŒåŒæ¢±ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

https://zod.dev/packages/mini

Mini ã¨ã„ã†åå‰ãŒã¤ã„ã¦ã„ã‚‹ãŒã€å†…éƒ¨çš„ã«ã¯ core ã‚’ãã®ã¾ã¾éœ²å‡ºã—ã¦ã„ã‚‹ã€‚

https://github.com/colinhacks/zod/blob/main/packages/zod/src/v4/mini/external.ts

æ—¢å­˜ã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯ classic ã¨ã„ã†å½¢ã§ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚

https://github.com/colinhacks/zod/tree/main/packages/zod/src/v4/classic

ã“ã‚Œã‚’é‘‘ã¿ã‚‹ã¨ã€æ¬¡ãŒäºˆæƒ³ã§ãã‚‹ã€‚

- Mini å´ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒä»Šå¾Œé•·ãä½¿ã‚ã‚Œã‚‹ã ã‚ã†ã“ã¨
- classic ã¯ã‚ã‚‹ã¦ã„ã©æä¾›ã•ã‚Œã‚‹ãŒã€ã‚µãƒãƒ¼ãƒˆã•ã‚Œãªããªã‚‹å¯èƒ½æ€§ãŒå‡ºã¦ããŸã“ã¨

ã¨ã„ã†ã‚ã‘ã§ã€ä»Šå¾Œã¯ã˜ã‚ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ Zod Mini ã‚’ä½¿ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

## ç§»è¡Œã—ãªã„ã¨ãƒ€ãƒ¡ï¼Ÿ

ã§ã€æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ v3 ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆãªã©ã€ç§»è¡Œã‚’ã©ã†ã™ã‚‹ã‹ï¼Ÿã¨ã„ã†èª²é¡ŒãŒæµ®ä¸Šã™ã‚‹ã€‚

ä¸€å¿œã€å…¬å¼ã§ã¯ **Zod Mini ã¸ã®ç§»è¡Œã¯ã¾ã æ¨å¥¨ã•ã‚Œã¦ã„ãªã„**ã€‚

https://zod.dev/packages/mini?id=when-not-to-use-zod-mini

ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é¢ã®ã¿ã‹ã‚‰ã®è¨€åŠãªã®ã§ã€æ˜ç¢ºã«æ¨å¥¨ã—ãªã„ã¨ã„ã†ã‚ˆã‚Šã€ç¾©å‹™ã‹ã‚‰ã®ç§»è¡Œã¯ã—ãªãã¦è‰¯ã„ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã¨æ€ã‚ã‚Œã‚‹ã€‚

ã¾ãŸã€ä»Šå¾Œã®æ–¹å‘æ€§ã¯ã¾ã æ±ºã¾ã£ã¦ã„ãªã„ã¨ã„ã†ã‹ã€è­°è«–ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã€ä»Šå¾Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒã©ã†ãªã‚‹ã‹ã¯ä¸ç¢ºå®šæ€§ãŒé«˜ã„ã€‚

- https://github.com/colinhacks/zod/discussions
- https://github.com/colinhacks/zod/issues

ã¾ã  Mini ã‚’ç¶™ç¶šã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã«ã¤ã„ã¦ã‚‚æ±ºã¾ã£ã¦ã„ãªã„ã¨è¦‹ãŸæ–¹ãŒè‰¯ã„ã€‚å¤šåˆ†è»½é‡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ãƒ‹ãƒ¼ã‚ºã¯å…¬å¼ã‚‚ã‚ã‹ã£ã¦ã„ã¦ã€ã¾ãšã¯ã“ã‚Œã§ã„ã‘ãã†ã‹ã€ã¨ã„ã†å¸‚å ´èª¿æŸ»ã®æ®µéšã ã¨æ€ã‚ã‚Œã‚‹ã€‚ãŸã ã¾ã‚ã€ã‚‚ã†åˆ©ç”¨å¯èƒ½ãªå½¢ã§å‡ºã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã„ã–ã‚„ã‚ã¾ã™ã¨ãªã£ã¦ã‚‚ã€ breaking change è¾¼ã¿ã§ã‚ã‚‹ã¦ã„ã©ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã ã‚ã†ã€‚

é‡è¦ã¨ãªã‚‹ã€ç§»è¡Œã§ãã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã©ã†ã‹ã®è¦‹æ¥µã‚ã ãŒã€ Mini ã§ã¯æ—¢å­˜ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ã‹ãªã‚Šã®éƒ¨åˆ†ã€å¤šåˆ† 95% ã¦ã„ã©ã¯ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã®ã§å¤§ä½“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç§»è¡Œã¯ã§ãã‚‹ã¯ãšã ã€‚å†…éƒ¨æ§‹é€ ã‚’å‰æã¨ã—ãŸãƒãƒƒã‚¯ã‚’ã—ã¦ã„ãªã„é™ã‚Šå¤§ä¸ˆå¤«ãªã¯ãšã€‚

ç·åˆã™ã‚‹ã¨ã€ç¾æ®µéšã§ã¯ç§»è¡Œã¯ç¾©å‹™ã«æ„Ÿã˜ã‚‹ã‚‚ã®ã§ã¯ãªãã€ã‚«ãƒªã‚«ãƒªã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ãŸã„å ´åˆã‚„ã€æ°—ã«ãªã£ãŸã‚‰ã‚„ã£ã¦ã¿ã‚‹ã¨ã„ã†ã®ãŒè‰¯ã„ã ã‚ã†ã€‚

## ç§»è¡Œã®éš›ã®èª²é¡Œ

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å†…éƒ¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã§ã‚ã‚‹ `core` ã‚’ä½¿ã£ã¦ã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã‚ˆã†ã ã€‚[ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ä½œæˆæ™‚ã¯ `core` ã‚’ä½¿ã£ã¦ãã‚Œã¨ã„ã†æ–‡è¨€ã¯è¦‹ã‹ã‘ãŸ](https://zod.dev/packages/core#:~:text=It%20is%20not%20intended%20to%20be%20used%20directly%3B%20instead%20it%27s%20designed%20to%20be%20extended%20by%20other%20packages.%20It%20implements%3A)ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã“ã†ä½¿ã£ã¦ã„ã‚‹ã®ãŒå…¬å¼ã§æ„å›³ã—ã¦ã„ã‚‹ã‹ã¯ä¸æ˜ã€‚

```typescript
import * as z from "zod/mini";

export function zodErrorToApiError(error: z.core.$ZodError): ApiError {
  const flattened = z.flattenError(error);

  // fieldErrors ã«ã¯ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå«ã¾ã‚Œã‚‹
  // ã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã§ã‚‚å€¤ãŒ undefined ã¨ã—ã¦è¿”ã£ã¦ãã‚‹ãŸã‚ã€ filter ã§é™¤å»ã™ã‚‹
  const cleanFieldErrors = Object.entries(flattened.fieldErrors)
    .filter((entry): entry is [string, string[]] => entry[1] !== undefined)
    .reduce<Record<string, string[]>>(
      (acc, [key, errors]) => ({
        ...acc,
        [key]: errors,
      }),
      {}
    );

  return {
    validationError: {
      formErrors: flattened.formErrors,
      fieldErrors: cleanFieldErrors,
    },
  };
}
```

ä»–ã¯å…¬å¼ãŒå¯¾ç…§è¡¨ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã‚‚ã‚ã£ã¦ã€ã™ã‚“ãªã‚Šã¨æ›¸ãæ›ãˆã§ããŸã€‚å€‹äººçš„ã«ã¯ãƒ‡ãƒ¼ã‚¿å‹ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ãŒåˆ†ã‘ã‚‰ã‚Œã‚‹ã®ã§èª­ã¿ã‚„ã™ããªã£ãŸãªã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚

```typescript
z.string().optional();
// ğŸ‘‡
z.optional(z.string());

z.number().int().min(0, "required");
// ğŸ‘‡
z.number().check(z.int(), z.minimum(0, "required"));
```

ä¸€å¿œã¾ã  v3 ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãŒå¤šã„ã®ã§ code agent ãŒ v3 ãƒ™ãƒ¼ã‚¹ã§å‡ºåŠ›ã—ã¦ãã‚‹ãã‚‰ã„ã ã‚ã†ã‹ã€‚
