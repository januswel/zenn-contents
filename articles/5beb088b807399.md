---
title: "特定のリポジトリーで Git commit 時に署名するための設定"
emoji: "✍️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [git, github, gpg, pgp]
published: false
publication_name: "beingish"
---

# summary

当該リポジトリーの `.git/config` に次のような設定が追加されている状態にする。 GPG 鍵を使うと良いだろう。

```ini
[user]
	email = nanashino.gonbee@example.com
	name = NANASHINO Gonbee
	signingkey = 24A01C981CDE28D4
[commit]
	gpgsign = true
```

# 設定手順

## GPG 鍵を生成する

[GPG の公式サイト](https://gnupg.org/documentation/index.html)や `man` コマンドはわかりづらい。 GitHub のページがほどよくまとまっているので参考にすると良い。

https://docs.github.com/ja/authentication/managing-commit-signature-verification/generating-a-new-gpg-key

次のコマンドで鍵を生成する。[ウィザード](<https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A3%E3%82%B6%E3%83%BC%E3%83%89_(%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2)>)が立ち上がるので質問に答えていく。

```shell
gpg --full-generate-key
```

2024 年春の時点で、アルゴリズムは ed25519 を選択するのが良いようだ。

`署名と暗号化` と `署名のみ` のどちらを選べばいいのかについては、今回の目的は署名なのでどちらを選んでも良い。

基本的に存命している限り同じ鍵を使うのが良いようなので、有効期限は無期限が良いようだ。が、 RSA 鍵がすでに安全でなくなってきているなど、同じ鍵を使い続けることにリスクが発生しているため、使う鍵を切り替える前提で判断したほうが良いと考えた。

メールアドレスは GitHub に登録しているものを使う。 GitHub には複数のメールアドレスを登録できるので使いたいものは先に登録しておくと良い。

まとめるとウィザードでの選択は次のようになる。

1. `ECC (署名と暗号化)` もしくは `ECC (署名のみ)` を選ぶ
2. `Curve 25519` を選ぶ
3. `3y` と入力する
4. 本名を入力する
   - アルファベット、漢字など好きなもので良い
5. GitHub に登録済みのメールアドレスを入力する
6. コメントは何を入力してもよい
   - 目的などを書いておくと管理しやすいかも
   - 空でも良い
7. パスフレーズを入力する
   - パスフレーズなしは推奨されていない

次を打って、今作ったものが表示されるか確認する。

```shell
gpg --list-secret-keys
```

## Git リポジトリーの設定を変更する

いつもと同じように commit する。

```shell
git add .
git commit -vm "sample commit"
```

確かめる。

```shell
git show --show-signature
# or
git log --show-signature
```

## GitHub に公開鍵をアップロードする

## GPG 鍵を保管する
