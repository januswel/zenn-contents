---
title: "FlatList ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ãŸã¨ãã«ä¸€åº¦ã ã‘ä½•ã‹ã™ã‚‹"
emoji: "ğŸ‘€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["reactnative"]
published: true
publication_name: "beingish"
---

ã‚ˆãã‚ã‚‹ã®ã¯ Google Analytics ãªã©ã€è¡Œå‹•ãƒ­ã‚°ã‚’è¨˜éŒ²ã—ãŸã„å ´åˆã ã‚ã†ã‹ã€‚

# FlatList ã‚ªãƒ—ã‚·ãƒ§ãƒ³

FlatList ã«ã¯ã“ã†ã—ãŸå ´åˆã«ä½¿ãˆã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚

- [`viewabilityConfig`](https://reactnative.dev/docs/flatlist#viewabilityconfig)
  - ã©ã†ãªã£ãŸã‚‰ã€Œè¦‹ãŸã€ã¨åˆ¤å®šã™ã‚‹ã‹ã©ã†ã‹ã®è¨­å®šå€¤
- [`onViewableItemsChanged`](https://reactnative.dev/docs/flatlist#onviewableitemschanged)
  - ã€Œè¦‹ãŸã€ã¨ãã«ã‚„ã‚‹ã“ã¨ã‚’æŒ‡å®š

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã©ã†æŒ‡å®šã—ãŸã‚‰ã©ã†ãªã‚‹ã‹ã¯æ¬¡ãŒè©³ã—ã„ã€‚

https://zenn.dev/luvmini511/articles/b28c0383b5d28a

ã¾ãŸã€ã€Œè¦‹ãŸã€ã‹ã©ã†ã‹ã®æ¡ä»¶ã‚’è¤‡æ•°æŒãŸã›ãŸã„å ´åˆã¯ [`viewabilityConfigCallbackPairs`](https://reactnative.dev/docs/flatlist#viewabilityconfigcallbackpairs) ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã€‚ Pairs ã¨ã„ã†åã®é€šã‚Š `viewabilityConfig` ã¨ `onViewableItemsChanged` ã®ãƒšã‚¢ã‚’ 1 ã‚»ãƒƒãƒˆã¨ã—ã¦æ‰±ã†ã€‚

```typescript
<FlatList
  onViewableItemsChanged={[
    {
      viewabilityConfig: {
        itemVisiblePercentThreshold: 50,
        minimumViewTime: 2000,
      },
      onViewableItemsChanged: () => {
        console.log("åŠåˆ†ãŒ 2 ç§’ä»¥ä¸Šè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨ãã«ã€Œè¦‹ãŸã€ã¨ã™ã‚‹");
      },
    },
    {
      viewabilityConfig: {
        viewAreaCoveragePercentThreshold: 0,
        minimumViewTime: 0,
        waitForInteraction: true,
      },
      onViewableItemsChanged: () => {
        console.log(
          "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤ºå¾Œã€ 1px ã§ã‚‚è¡¨ç¤ºã•ã‚ŒãŸã‚‰å³åº§ã«ã€Œè¦‹ãŸã€ã¨ã™ã‚‹"
        );
      },
    },
  ]}
/>
```

# ã€Œä¸€åº¦ã ã‘ã€ã®åˆ¤å®š

ã€Œè¦‹ãŸã€ã¨ãã«è¨˜éŒ²ã™ã‚‹ã“ã¨ã§å¯¾å¿œã™ã‚‹ã€‚ãã®éš›ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒèµ°ã‚‰ãªã„ã‚ˆã†ã« ref ã‚’ä½¿ã†ã€‚

custom hook ã¨ã—ã¦å®šç¾©ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚

https://github.com/januswel/ViewabilityConfigSample/blob/main/useOnViewedItem.ts

`Array#push` ã‚’ä½¿ã£ã¦è¤‡æ•°ã®æ¡ä»¶ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã« `onViewableItemsChanged` ã«æ¸¡ã›ã‚‹å½¢ã§çµæœã‚’è¿”ã—ã¦ã„ã‚‹ã€‚

:::details `ViewToken` å‹ã®æ”¹è‰¯
`ViewToken` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ `item` ã®å‹ãŒ `any` ãªã®ã§ä½¿ã„ã¥ã‚‰ã„ã€‚ã“ã‚Œã‚’ä½•ã¨ã‹ã™ã‚‹ãŸã‚ã« `ViewToken` ã‚’ generic ãªå‹ã¨ã—ã¦å®šç¾©ã—ãªãŠã—ã¦ä½¿ã£ã¦ã„ã‚‹ã€‚

```typescript
import type { ViewToken as RNViewToken } from "react-native";

export type ViewToken<$Item> = Omit<RNViewToken, "item"> & { item: $Item };
```

:::

ä½¿ã†ã¨ãã¯æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ã€‚

```typescript
export default function App(): React.JSX.Element {
  const onViewConfigurations = useOnViewedItem<Item>((token) => {
    console.log("viewed", token);
  });

  return <FlatList viewabilityConfigCallbackPairs={onViewConfigurations} />;
}
```
