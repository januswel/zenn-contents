---
title: "Next.js ã® allowedDevOrigins ã‚’ã„ã„æ„Ÿã˜ã«è¨­å®šã™ã‚‹"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs"]
published: true
publication_name: "beingish"
---

Next.js 14.2.30 / 15.2.2 ä»¥é™ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã«å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªè­¦å‘ŠãŒå‡ºã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

```
 âš  Blocked cross-origin request from 192.168.xxx.yyy to /_next/* resource. To allow this, configure "allowedDevOrigins" in next.config
Read more: https://nextjs.org/docs/app/api-reference/config/next-config-js/allowedDevOrigins
```

ã“ã‚Œã¯è„†å¼±æ€§å¯¾å¿œã«ã‚ˆã‚‹ã‚‚ã®ã€‚è©³ã—ãã¯å…¬å¼ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ã‚’èª­ã‚€ã¨è‰¯ã„ã€‚

https://vercel.com/changelog/cve-2025-48068

è¿½åŠ ã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ `allowedDevOrigins` ã¨ã„ã†ã‚‚ã®ã§ã€ã“ã“ã«æŒ‡å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãªã‚¢ã‚¯ã‚»ã‚¹ã¯è­¦å‘Šã‚’å‡ºã™ã€‚ç¾åœ¨ã¯ã¾ã è­¦å‘Šã®ã¿ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãŸã‚Šã—ãªã„ã€‚ãƒ–ãƒ­ãƒƒã‚¯æŒ™å‹•ã¯å°†æ¥æœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ã‚‰ã—ã„ã€‚

https://nextjs.org/docs/app/api-reference/config/next-config-js/allowedDevOrigins

ã¤ã¾ã‚Šã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã«å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€ä»Šã®ã†ã¡ã«ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚

## è¨­å®š

`allowedDevOrigins` ã«ã¯é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ãŸã¦ã¦ã„ã‚‹ãƒã‚·ãƒ³ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ›ã‚¹ãƒˆåã‚’æŒ‡å®šã™ã‚‹ã€‚

next.config.ts ãªã©ã§æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã€‚

```ts:next.config.ts
export default {
  allowedDevOrigins: ["192.168.xxx.yyy", "your.hostname"]
}
```

è¨­å®šä¾‹ã§æ°—ä»˜ã„ãŸæ–¹ã‚‚ã„ã‚‹ã ã‚ã†ãŒã€ã“ã®å€¤ã¯äººã«ã‚ˆã£ã¦ç•°ãªã‚‹ã®ã§ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼é–“ã§çµ±ä¸€ã§ããªã„ã€‚æ¬¡ã®ç†ç”±ã‚‚ã‚ã£ã¦ã€å˜ç´”ã« next.config.ts ã«æ›¸ã„ã¦å…±æœ‰ã§ããªã„é¡ã®è¨­å®šã ã€‚

- ãƒ›ã‚¹ãƒˆåã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç°¡å˜ã«å–å¾—ã§ãã‚‹ãŒãã‚‚ãã‚‚è¨­å®šã—ã¦ã„ãªã„å ´åˆãŒã‚ã‚‹
- æœ€è¿‘ã®ãƒã‚·ãƒ³ã¯ NIC ãŒè¤‡æ•°ã•ã•ã£ã¦ã„ã‚‹ã®ãŒæ™®é€šãªã®ã§ã€ã©ã‚Œã‚’ä½¿ã†ã®ã‹ã¯ãƒã‚·ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãªã„ã¨åˆ¤åˆ¥ã§ããªã„
- IPv4 ã¨ IPv6 ã©ã¡ã‚‰ã‚’ä½¿ã†ã®ã‹ã¯å¥½ã¿ãªã®ã§ã€é©åˆ‡ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯è‡ªå‹•å–å¾—ã§ããªã„ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€ãƒ¡ãƒ³ãƒãƒ¼ãŒå„è‡ªã§è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ `allowedDevOrigins` ãªã©ãƒ­ãƒ¼ã‚«ãƒ«å›ºæœ‰ã®è¨­å®šã‚’ next.config.ts å†…ã§å‹•çš„ã«èª­ã¿è¾¼ã‚€ã¨ã„ã†å½¢ã‚’ã¨ã£ã¦ã¿ãŸã€‚

ã¾ãšæ¬¡ã‚’å®šç¾©ã™ã‚‹ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆç›´ä¸‹ã«ã‚ã‚‹ next.config.local.cjs ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚“ã§ Next.js è¨­å®šã¨ã—ã¦è¿½åŠ ã™ã‚‹é–¢æ•°ã ã€‚

```ts:withLocalConfig.ts
import type { NextConfig } from "next";
import { join } from "path";
import { existsSync } from "fs";
import { dirname } from "path";

const LOCAL_CONFIG_GENERATOR = "next.config.local.cjs";

export type LocalConfigGenerator = NextConfig | (() => NextConfig);

function findProjectRootSync(): string {
  let currentDir = process.cwd();

  while (currentDir !== "/") {
    const packageJsonPath = join(currentDir, "package.json");
    if (existsSync(packageJsonPath)) {
      return currentDir;
    }
    currentDir = dirname(currentDir);
  }

  return process.cwd();
}

export async function withLocalConfig(config: NextConfig) {
  let localConfigGenerator: { default: LocalConfigGenerator } | null = null;
  try {
    const projectRoot = findProjectRootSync();
    const configPath = join(projectRoot, LOCAL_CONFIG_GENERATOR);
    localConfigGenerator = await import(configPath);
    console.log(`${LOCAL_CONFIG_GENERATOR} is loaded`);
  } catch (e) {
    if (e instanceof Error) {
      if (!("code" in e && e.code == "MODULE_NOT_FOUND")) {
        console.error(`loading ${LOCAL_CONFIG_GENERATOR} raised error: `, e);
      }
    }
  }

  const localConfig =
    typeof localConfigGenerator?.default === "function"
      ? localConfigGenerator.default()
      : localConfigGenerator?.default ?? {};

  return {
    ...config,
    ...localConfig,
  };
}
```

ã§ã€ã“ã†ä½¿ã†ã€‚

```ts:next.config.ts
import { withLocalConfig } from "@/utils/withLocalConfig";
import type { NextConfig } from "next";

const config: NextConfig = {
  // ãƒãƒ¼ãƒ å†…ã§å…±æœ‰ã™ã‚‹è¨­å®š
};

export default withLocalConfig(config);
```

é–¢æ•°ã§æŒ‡å®šã§ããŸã»ã†ãŒæ±ç”¨çš„ã‹ãªã¨æ€ã£ã¦ã€ next.config.local.cjs ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚’æ›¸ãå½¢ã¨ã—ãŸã€‚ JavaScript ã§æ›¸ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã¯ã€Next.js ãŒç«‹ã¡ä¸ŠãŒã‚‹ã¨ãã«ã¯ next.config.ts ã¯ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ JS ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚‰ã€‚

å€‹äººã”ã¨ã§é•ã†ã®ã§ Git ç®¡ç†ã•ã‚Œãªã„ã‚ˆã†ã« .gitignore ã«è¿½åŠ ã—ã¦ãŠãã€‚

```:.gitignore
next.config.local.cjs
```

ã“ã“ã¾ã§ã‚’ commit ã—ã€ãƒãƒ¼ãƒ å†…ã§å…±æœ‰ã™ã‚‹ã€‚

å„ãƒ¡ãƒ³ãƒãƒ¼ã¯ãã‚Œãã‚Œã€æ¬¡ã®ã‚ˆã†ã«è¨­å®šã‚’æ›¸ãã€‚

```js:next.config.local.cjs
module.exports = {
  allowedDevOrigins: ["192.168.xxx.yyy", "your.hostname"],
}
```

é–¢æ•°ã§æ›¸ããŸã„å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«ã€‚ä½•ã‹å‡¦ç†ã‚’æŒŸã¿ãŸã„ã¨ãã«ä½¿ã†ã¨è‰¯ã„ã€‚

```js:next.config.local.cjs
module.exports = () => {
  // ãªã«ã‹å‡¦ç†ã‚’æ›¸ã

  return {
    allowedDevOrigins: ["192.168.xxx.yyy", "your.hostname"],
  };
}
```

ã“ã‚Œã§è­¦å‘ŠãŒå‡ºãªããªã‚‹ã€‚
