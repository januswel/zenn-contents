---
title: "Claude Code Hooks ã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„å“è³ªå‘ä¸Šã‚’ã‚·ãƒ•ãƒˆãƒ¬ãƒ•ãƒˆã™ã‚‹"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["claudecode", "claude"]
published: true
publication_name: "beingish"
---

## ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

ãµãŸã¤ã‚ã‚‹ã€‚

### è‡ªåˆ†ã§æ›¸ãå ´åˆã®åŠ¹ç‡å‘ä¸Š

è»¸ã‚’æ˜æ–‡åŒ–ã—ã‚„ã™ã„éƒ¨åˆ†ã¯ code agent ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸãŒã€åŸºæœ¬çš„ã« Pull Request å˜ä½ã§ã®ä¾é ¼ã¨ãªã‚‹ã€‚

å¸¸ã€… PR ãƒ™ãƒ¼ã‚¹ã§ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ãƒ™ã‚¹ãƒˆã§ã¯ãªã„ã¨è€ƒãˆã¦ãŠã‚Šã€æ›¸ã„ãŸãã°ã‹ã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œãªã„ã‹ãªã‚ã€ã¨è€ƒãˆã¦ã„ãŸã€‚

- ã‚³ãƒ¼ãƒ‰æ›¸ãã¨ããŒä¸€ç•ªãã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã‹ã£ã¦ã‚‹
  - ã¡ã‚‡ã£ã¨ã§ã‚‚æ™‚é–“çµŒã¤ã¨æ€ã„å‡ºã™ã®ã«ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®æŒ‡æ‘˜ã«ã‚ˆã£ã¦ã¯ä½œæ¥­ã—ãªãŠã—
  - ã‚‚ã£ã¨æ—©ãè¦‹ã¦ã»ã—ã‹ã£ãŸ
- æ‰‹å…ƒã«å¼•ã£å¼µã£ã¦ã“ãªã„ã¨ LSP ãªã©ã‚³ãƒ¼ãƒ‰ç†è§£ã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ãˆãªã„
  - PR ç”»é¢ã ã‘ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã®ã¯ã¤ã‚‰ã¿

è¦ã¯ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ QA æ´»å‹•ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ã®ã§ã‚·ãƒ•ãƒˆãƒ¬ãƒ•ãƒˆã™ã‚‹ã¨ã†ã¾ã¿ãŒã‚ã‚‹ã‚ˆã­ã€ã¨ã„ã†ç™ºæƒ³ã€‚

ã¾ãŸã€çµ„ç¹”ã®ãƒ«ãƒ¼ãƒ«ãŒ CI ã«é›†ç´„ã•ã‚Œã‚‹ãŒã€ã“ã‚Œã‚‚åˆ¥ã«ä¸€èˆ¬çš„ãª CI ã‚·ã‚¹ãƒ†ãƒ ã§ãªãæ‰‹å…ƒã§æ›¸ããã°ã‹ã‚‰ãƒ«ãƒ¼ãƒ«ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚‹ã¨è‰¯ã„ã‚ˆã­ã€ã¨ã„ã†ã®ã‚‚ã‚³ãƒŸã ã€‚ formatting ã‚„ linting ãªã©å®šå‹ã®ã‚‚ã®ã ã‘ã§ãªãã€è‡ªç„¶è¨€èªã§ãªã„ã¨æŒ‡ç¤ºãŒé›£ã—ã„ã‚‚ã®ã‚‚ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

### ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å“è³ªå‘ä¸Š

ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ç‚¹ã§å“è³ªã¨ã—ã¦ã¯å•é¡Œã«ãªã‚Šã‚„ã™ã„ã€‚

- ã‚³ãƒ”ãƒšã‚³ãƒ¼ãƒ‰
- ãƒ™ã‚¿æ›¸ãã‚³ãƒ¼ãƒ‰
- [ã™ããƒ«ãƒ¼ãƒ«å¿˜ã‚Œã‚‹å•é¡Œ](https://zenn.dev/sesere/articles/0420ecec9526dc)

ã“ã‚Œã‚‰ã¯ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«é–¢ã™ã‚‹é©åˆ‡ãªè©•ä¾¡é–¢æ•°ãŒãªã„ãŸã‚ã«ç”Ÿã˜ã¦ã„ã‚‹å•é¡Œã§ã‚‚ã‚ã‚‹ã€‚ç”Ÿæˆã€œè©•ä¾¡ã¾ã§ã‚’è‡ªå‹•åŒ–ã—ãŸã„ã€ã¨ã„ã†ãƒ‹ãƒ¼ã‚ºã€‚

https://x.com/t_wada/status/1922110843270885789

## ã©ã†ã™ã‚‹ã‹ï¼Ÿ

Claude Code ã® Stop Hooks ã‚’ä½¿ã†ã€‚

https://docs.anthropic.com/ja/docs/claude-code/hooks#stop

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ¬¡ã®é€šã‚Šã€‚

```sh:.claude/maintainability.sh
#!/bin/sh

# https://docs.anthropic.com/ja/docs/claude-code/hooks#stop%E3%81%A8subagentstop%E5%85%A5%E5%8A%9B
# ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é¿ã‘ã‚‹ãŸã‚ stop_hook_active ãŒ true ãªã‚‰ä½•ã‚‚ã—ãªã„
INPUT=$(timeout 1 cat 2>/dev/null || echo "")
STOP_HOOK_ACTIVE=$(echo "$INPUT" | jq -r '.stop_hook_active // false')
if [ "$STOP_HOOK_ACTIVE" = "true" ]; then
  exit 0
fi

# git repo ã§ãªã„å ´åˆã€ä½•ã‚‚ã—ãªã„
CURRENT_BRANCH=$(git branch --show-current 2>/dev/null || echo "unknown")
if [ "$CURRENT_BRANCH" = "unknown" ]; then
  exit 0
fi

# commit æ¸ˆã¿ main ã¨ã®å·®åˆ†
COMMITTED_DIFF=$(git diff --name-only main..HEAD 2>/dev/null)
# staging æ¸ˆã¿
STAGED_FILES=$(git diff --name-only --cached 2>/dev/null)
# staging å‰ã®å¤‰æ›´
UNSTAGED_FILES=$(git diff --name-only 2>/dev/null)

CHANGED_FILES=$(printf '%s\n%s\n%s' "${COMMITTED_DIFF}" "${STAGED_FILES}" "${UNSTAGED_FILES}" | sort -u | grep -v '^$')

# å¤‰æ›´ãŒãªã„å ´åˆã€ä½•ã‚‚ã—ãªã„
if [ -z "$CHANGED_FILES" ]; then
  exit 0
fi

REASON_TEXT="å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
${CHANGED_FILES}

æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹è¦³ç‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„
- @docs/quality-gate.md
- @docs/dev-guideline.md"

if [ -z "$INPUT" ]; then
  # æ‰‹å‹•å®Ÿè¡Œæ™‚
  echo "$REASON_TEXT"
  exit 0
else
  # Claude Hooks çµŒç”±
  # https://docs.anthropic.com/ja/docs/claude-code/hooks#stop%2Fsubagentstop%E6%B1%BA%E5%AE%9A%E5%88%B6%E5%BE%A1
  cat << EOF >&2
{
  "decision": "block",
  "reason": "$REASON_TEXT"
}
EOF
  exit 2
fi
```

docs/quality-gate.md ã«ã¯å“è³ªãƒã‚§ãƒƒã‚¯ç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›¸ãã€‚

```markdown:docs/quality-gate.md
# Quality Gate

- é–¢æ•°ã®è¡Œæ•°ã¯ 50 è¡Œã¾ã§
- DRY åŸå‰‡ã®éµå®ˆ
  - 10 è¡Œä»¥ä¸Šã®é‡è¤‡ã¯é–¢æ•°åŒ–
  - å…¨ãåŒã˜é–¢æ•°ã®é‡è¤‡å®šç¾©ã¯è¡Œæ•°ã«é–¢ã‚ã‚‰ãšå…±é€šåŒ–
- YAGNI åŸå‰‡ã®éµå®ˆ
  - æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã¯å‰Šé™¤
- React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥å¤–ã®é–¢æ•°ã¯ãƒ†ã‚¹ãƒˆå¿…é ˆ
- ä½¿ã£ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã“ã¨
```

docs/dev-guideline.md ã«ã¯é–‹ç™ºæ™‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ›¸ã„ã¦ãŠã“ã†ã€‚

```markdown:docs/dev-guideline.md
## ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«

- `interface`ã§ã¯ãªã `type` ã§å‹å®šç¾©ã™ã‚‹
- React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® props åã¯`Props`
- if ç¯€ã¯é•·ã•ã«ã‹ã‹ã‚ã‚‰ãšå¿…ãš `{}` ã§ããã‚‹
- ã‚³ãƒ¡ãƒ³ãƒˆã¯ not why ã«çµã£ã¦æ›¸ã
  - æ—¥æœ¬èªå¸¸ä½“ã§æ›¸ã

## ãƒ¬ãƒ“ãƒ¥ãƒ¼

ã‚³ãƒ¼ãƒ‰å¤‰æ›´å¾Œã¯å¤‰æ›´å†…å®¹ã®èª¬æ˜ã¨ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’å«ã‚ã¦æ¬¡ã®è¦³ç‚¹ã§ç°¡æ˜“ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½

- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- å¯èª­æ€§
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
```

å®Ÿéš›ä½¿ã†å ´åˆã¯ã“ã“ã‚’è‡ªåˆ†å¥½ã¿ã«ã™ã‚‹ã€‚ä¸€å¿œã“ã‚Œãã‚‰ã„ç°¡æ˜“ãªã‚‚ã®ã§ã‚‚å‰²ã¨åŠ¹ãã€‚

è¦³ç‚¹ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¦ã„ã‚‹ã®ã§ã€é©å®œã“ã“ã ã‘å¤‰ãˆã‚‹ã®ã‚‚ CLAUDE.md ã‹ã‚‰å‚ç…§ã•ã›ã‚‹ã®ã‚‚ã‚„ã‚Šã‚„ã™ã„ã€‚

ã§ã€æ¬¡ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã€‚

```json:.claude/settings.json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "/path/to/your/project/.claude/maintainability.sh"
          }
        ]
      }
    ]
  }
}
```

ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯ã“ã‚Œã§å³åº§ã«ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã¨ãªã‚‹ã€‚è‡ªåˆ†ã§æ›¸ã„ãŸã‚‚ã®ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã»ã—ã„å ´åˆã¯é©å½“ã«ä¼šè©±ã‚’æŠ•ã’ã‚‹ã¨è¦‹ã¦ãã‚Œã‚‹ã€‚

```
> ã‚

âº ã¯ã„ã€ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ

> Stop hook feedback:
  - [~/work/being-ish/carnelian/.claude/maintainability.sh]: {
    "decision": "block",
    "reason": "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
  .claude/maintainability.sh

  æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹è¦³ç‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„
  - @docs/quality-gate.md
  - @docs/dev-guideline.md"
  }
```
